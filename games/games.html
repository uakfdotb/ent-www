<!-- INCLUDE overall_header.html -->

<LINK href="games.css" rel="stylesheet" type="text/css">
<h1>Games list</h1>

<div class="panel">
   <div class="inner"><span class="corners-top"><span></span></span>

<SCRIPT type="text/javascript" src="/jquery.js">
</SCRIPT>

<SCRIPT type="text/javascript" src="/zeroclipboard/ZeroClipboard.js">
</SCRIPT>

<SCRIPT type="text/javascript">
<!-- PHP -->
$id = 0;
if(isset($_REQUEST['id'])) $id = $_REQUEST['id'];
echo "var id = $id;"
<!-- ENDPHP -->

var inactiveCount = 0;
var botsString = "{BOTS}";
var botsArray = botsString.split(",");

function refreshGames() {
	if($('input[name=showall]').is(':checked')) {
		$.get('games_all_fast.php', {}, processGamesFast, 'html');
	} else {
		$.get('games_fast.php', {}, processGamesFast, 'html');
	}
	$('#playerstable').load('slots_fast.php?id=' + id);
}

var refreshId = setInterval(function()
{
	if(inactiveCount > 180) {
		var inactiveMinutes = Math.floor(inactiveCount / 6);
		$('#playerstable').html("<h2>You have been idle for " + inactiveMinutes + " minutes.<br><a style=\"color: maroon\" href=\"javascript:updateId(0);\">Click here to continue refreshing.</a></h2>");
	} else {
		refreshGames();
	}

	inactiveCount++;
}, 10000);

function processGamesFast(data) {
	var gamesTable = "<tr><th class=\"games\">Gamename</th><th class=\"games\">&nbsp;&nbsp;Slots&nbsp;&nbsp;</th><th class=\"games\">Copy&nbsp;</th><th class=\"games\">&nbsp;&nbsp;Connect</th></tr>";
	var gamesArray = data.split("\n");

	for(var k = 0; k < 3; k++) { //first pass: preferred games; second pass: other games; third pass: non-lobby games
		if(k == 1 || k == 2) {
			gamesTable += "<tr><td colspan=\"4\"><hr></td></tr>";
		}

		for(var i = 0; i < gamesArray.length; i++) {
			var rowArray = gamesArray[i].split("|", 6);

			if(rowArray.length == 6) {
				var rowid = parseInt(rowArray[0]);
				var botid = parseInt(rowArray[1]);

				if(k < 2 && rowArray[4] == "0") {
					continue;
				} else if(k == 2 && rowArray[4] == "1") {
					continue;
				} else if($('input[name=hideempty]').is(':checked') && rowArray[2] == "0") {
					continue;
				} else if($('input[name=hidedota]').is(':checked') && rowArray[5].toLowerCase().indexOf("dota") != -1) {
					continue;
				} else if((k == 0 && $.inArray(botid + "", botsArray) == -1) || (k == 1 && $.inArray(botid + "", botsArray) != -1)) {
					continue;
				}

				//get the ghostclient id
				var gcId = 0;

				if(botid >= 101 && botid <= 108) {
					gcId = botid + 165;
				} else if(botid == 1 || botid == 2) {
					gcId = botid + 47;
				} else if(botid >= 4 && botid <= 36) {
					gcId = botid + 46;
				} else if(botid >= 37 && botid <= 40) {
					gcId = botid + 115;
				} else if(botid >= 4 && botid <= 36) {
					gcId = botid + 46;
				} else if(botid == 47) {
					gcId = 157;
				} else if(botid == 57) {
					gcId = 158;
				} else if(botid >= 41 && botid <= 46) {
					gcId = botid + 118;
				} else if(botid >= 48 && botid <= 56) {
					gcId = botid + 117;
				} else if(botid >= 58 && botid <= 69) {
					gcId = botid + 116;
				} else if(botid >= 70 && botid <= 81) {
					gcId = botid + 138;
				}

				gamesTable += "<tr onmousedown=\"updateId(" + rowArray[0] + ");\" style=\"font-family:Helvetica, Arial, sans-serif; font-size:15px; margin-top:2px;\">";
				gamesTable += "<td>";
				gamesTable += "<a style=\"color: maroon;\">";
				gamesTable += rowArray[5] + "</a></td><td style=\"padding-left:10px;\">" + rowArray[2] + "/" + rowArray[3];
				gamesTable += "</td><td><img height=\"18\" width=\"18\" class=\"copiable\" src=\"clipboard.png\" gamename=\"" + rowArray[5] + "\" ></td>";
				gamesTable += "<td><center><a href=\"ghostclient:?connect=" + gcId + "\"><img src=\"gc.png\"></a>";
				gamesTable += "&nbsp;<a href=\"/entconnect/?filter=" + encodeURIComponent(rowArray[5]) + "\" target=\"_blank\"><img src=\"ec.png\"></a></center></td>";
				gamesTable += "</tr>";
			}
		}
	}

	hideChecked = $('input[name=hideempty]').is(':checked') ? " checked" : "";
	gamesTable += "<tr style=\"font-family:Helvetica, Arial, sans-serif; font-size:15px; margin-top:2px;\"><td colspan=\"3\"><input type=\"checkbox\" name=\"hideempty\" onchange=\"refreshGames();\"" + hideChecked + "> Hide empty lobbies</td></tr>";

	dotaChecked = $('input[name=hidedota]').is(':checked') ? " checked" : "";
	gamesTable += "<tr style=\"font-family:Helvetica, Arial, sans-serif; font-size:15px; margin-top:2px;\"><td colspan=\"3\"><input type=\"checkbox\" name=\"hidedota\" onchange=\"refreshGames();\"" + dotaChecked + "> Hide DotA games</td></tr>";

	allChecked = $('input[name=showall]').is(':checked') ? " checked" : "";
	gamesTable += "<tr style=\"font-family:Helvetica, Arial, sans-serif; font-size:15px; margin-top:2px;\"><td colspan=\"3\"><input type=\"checkbox\" name=\"showall\" onchange=\"refreshGames();\"" + allChecked + "> Include games in progress</td></tr>";

	gamesTable += "<tr><td colspan=\"3\"><img src=\"blank.gif\" onload=\"init();\"></td></tr>";
	$('#gamestable').html(gamesTable);
}

function updateId(newId) {
	id = newId;
	inactiveCount = 0;
	$('#playerstable').load('slots_fast.php?id=' + id);
}

if($('input[name=showall]').is(':checked')) {
	$.get('games_all_fast.php', {}, processGamesFast, 'html');
} else {
	$.get('games_fast.php', {}, processGamesFast, 'html');
}
</SCRIPT>

<table border="0" style="padding-top:6px;">
<tr valign="top"><td style="text-align:top">

<table id="gamestable">
</table>

</td><td style="text-align:top;padding-left:50px;">

<div id="playerstable">
<!-- PHP -->
include("slots_fast.php");
<!-- ENDPHP -->
</div>

<script type="text/javascript"><!--
google_ad_client = "ca-pub-0857519020745551";
/* ad3 */
google_ad_slot = "6710306422";
google_ad_width = 336;
google_ad_height = 280;
//-->
</script>
<script type="text/javascript"
src="https://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

</td></tr>
</table>

<SCRIPT type="text/javascript">
ZeroClipboard.setMoviePath('/zeroclipboard/ZeroClipboard.swf');
var clip = null;

function init() {
 clip = new ZeroClipboard.Client();
 clip.setHandCursor(false);

 $('.copiable').mouseover( function() {
  clip.setText( $(this).attr('gamename') );

  if (clip.div) {
   clip.receiveEvent('mouseout', null);
   clip.reposition(this);
  }
  else clip.glue(this);

  clip.receiveEvent('mouseover', null);
 });
}

</SCRIPT>

<br /><br />
   <span class="corners-bottom"><span></span></span></div>
</div>

<!-- INCLUDE jumpbox.html -->
<!-- INCLUDE overall_footer.html -->
